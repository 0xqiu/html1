<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸš€ CryptoAI Â· 4å°æ—¶Kçº¿å¼ºå¼±å¯¹æ¯” Â· å®æ—¶æ¶¨è·Œå¹…å·®å€¼</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'å¾®è½¯é›…é»‘', Roboto, sans-serif;
            background: #0B0E14;
            color: #FFFFFF;
            min-height: 100vh;
            padding: 16px;
        }
        
        /* ç°ä»£é…è‰² - å®Œå…¨ç§»æ¤Pythonç‰ˆæœ¬ */
        :root {
            --bg: #0B0E14;
            --surface: #1A1E26;
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --secondary: #8B5CF6;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --text-primary: #FFFFFF;
            --text-secondary: #94A3B8;
            --text-tertiary: #64748B;
            --border: #2D3748;
            --card: #1E2430;
            --btc: #F7931A;
            --eth: #627EEA;
            --sol: #9945FF;
            --bnb: #F3BA2F;
            --nasdaq: #00FF9D;
            --ai: #4F46E5;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* æ ‡é¢˜æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .title {
            font-size: 22px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--ai));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--surface);
            padding: 6px 16px;
            border-radius: 30px;
            border: 1px solid var(--border);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
        }
        
        /* å®æ—¶æ¶¨è·Œå¯¹æ¯”å¡ç‰‡ - æ”¾å¤§æ˜¾ç¤º */
        .diff-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 16px;
        }
        
        .diff-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .diff-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .diff-content {
            display: flex;
            align-items: center;
            justify-content: space-around;
        }
        
        .coin-block {
            flex: 1;
            text-align: center;
        }
        
        .coin-symbol {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .coin-price {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        
        .coin-base {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        
        .coin-change {
            font-size: 24px;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 40px;
            display: inline-block;
        }
        
        .vs-divider {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-secondary);
            margin: 0 20px;
        }
        
        .diff-result {
            margin-top: 12px;
            padding: 10px;
            background: var(--primary);
            border-radius: 40px;
            text-align: center;
        }
        
        .diff-result-text {
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        
        /* å¸ç§é€‰æ‹©æ  */
        .selector-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        
        .selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .selector-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .coin-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .coin-btn {
            padding: 8px 20px;
            border-radius: 30px;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            background: var(--card);
            color: var(--text-secondary);
            transition: all 0.2s;
        }
        
        .coin-btn.active {
            color: white;
        }
        
        .coin-btn.btc.active { background: var(--btc); }
        .coin-btn.eth.active { background: var(--eth); }
        .coin-btn.sol.active { background: var(--sol); }
        .coin-btn.bnb.active { background: var(--bnb); color: black; }
        .coin-btn.nasdaq.active { background: var(--nasdaq); color: black; }
        
        /* é¢‘ç‡æ§åˆ¶ + ä»·æ ¼å¡ç‰‡å¹¶æ’ */
        .mid-panel {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .freq-panel {
            flex: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
        }
        
        .freq-row {
            display: flex;
            gap: 12px;
        }
        
        .freq-item {
            flex: 1;
        }
        
        .freq-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .freq-label-text {
            font-size: 14px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .freq-status {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .freq-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .freq-btn {
            padding: 6px 12px;
            border-radius: 20px;
            border: none;
            font-size: 12px;
            background: var(--card);
            color: var(--text-primary);
            cursor: pointer;
        }
        
        .freq-btn:hover {
            background: var(--primary-dark);
        }
        
        .custom-freq {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }
        
        .custom-input {
            width: 50px;
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
            background: var(--card);
            color: var(--text-primary);
            margin: 0 4px;
            text-align: center;
        }
        
        /* ä»·æ ¼å¡ç‰‡ */
        .price-cards {
            display: flex;
            gap: 12px;
        }
        
        .price-card {
            width: 240px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            overflow: hidden;
        }
        
        .card-bar {
            width: 4px;
            background: var(--btc);
        }
        
        .card-content {
            flex: 1;
            padding: 12px 16px;
        }
        
        .card-title {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .card-price {
            font-size: 22px;
            font-weight: bold;
            display: inline-block;
            margin-right: 8px;
        }
        
        .card-change {
            font-size: 14px;
        }
        
        /* è¿‘æœŸè®°å½•è¡¨æ ¼ */
        .records-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .records-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
        }
        
        .records-time {
            color: var(--text-secondary);
        }
        
        .records-table {
            background: var(--card);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .record-row {
            display: flex;
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .record-time { width: 70px; color: var(--text-secondary); }
        .record-coin1 { width: 50px; font-weight: bold; }
        .record-price1 { width: 100px; text-align: right; }
        .record-change1 { width: 80px; text-align: right; }
        .record-coin2 { width: 50px; font-weight: bold; margin-left: 10px; }
        .record-price2 { width: 100px; text-align: right; }
        .record-change2 { width: 80px; text-align: right; }
        .record-strength { flex: 1; text-align: right; font-weight: bold; }
        
        /* AIåˆ†æé¢æ¿ */
        .ai-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        
        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .ai-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-title-text {
            font-size: 18px;
            font-weight: bold;
            color: var(--ai);
        }
        
        .ai-subtitle {
            color: var(--text-secondary);
        }
        
        .ai-analyze-btn {
            background: var(--ai);
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 30px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .ai-analyze-btn:hover {
            background: var(--primary-dark);
        }
        
        .ai-content {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* å·¥å…·ç±» */
        .up { color: var(--success); }
        .down { color: var(--danger); }
        .equal { color: var(--text-secondary); }
        .btc-color { color: var(--btc); }
        .eth-color { color: var(--eth); }
        .sol-color { color: var(--sol); }
        .bnb-color { color: var(--bnb); }
        .nasdaq-color { color: var(--nasdaq); }
        .ai-color { color: var(--ai); }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜æ  -->
        <div class="header">
            <span class="title">âš¡ 4å°æ—¶Kçº¿å¼ºå¼±å¯¹æ¯” Â· å®æ—¶å·®å€¼ Â· DeepSeek AI</span>
            <div class="status-bar" id="statusBar">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">ğŸŸ¢ å®æ—¶è¿æ¥ä¸­...</span>
            </div>
        </div>

        <!-- å®æ—¶æ¶¨è·Œå¯¹æ¯”å¡ç‰‡ -->
        <div class="diff-card">
            <div class="diff-header">
                <span class="diff-title">ğŸ“Š å®æ—¶æ¶¨è·Œå¯¹æ¯”</span>
                <span style="color: var(--text-secondary);">1ç§’/æ¬¡</span>
            </div>
            <div class="diff-content">
                <div class="coin-block">
                    <div class="coin-symbol" id="diffCoin1Symbol" style="color: var(--btc);">BTC</div>
                    <div class="coin-price" id="diffCoin1Price">$--</div>
                    <div class="coin-base" id="diffCoin1Base">åŸºå‡†: --</div>
                    <div class="coin-change" id="diffCoin1Change">--</div>
                </div>
                <div class="vs-divider">VS</div>
                <div class="coin-block">
                    <div class="coin-symbol" id="diffCoin2Symbol" style="color: var(--eth);">ETH</div>
                    <div class="coin-price" id="diffCoin2Price">$--</div>
                    <div class="coin-base" id="diffCoin2Base">åŸºå‡†: --</div>
                    <div class="coin-change" id="diffCoin2Change">--</div>
                </div>
            </div>
            <div class="diff-result" id="diffResultContainer">
                <span class="diff-result-text" id="diffResult">è¯·é€‰æ‹©ä¸¤ä¸ªå¯¹æ¯”æ ‡çš„</span>
            </div>
        </div>

        <!-- å¸ç§é€‰æ‹©æ  -->
        <div class="selector-container">
            <div class="selector-header">
                <span class="selector-title">ğŸ”„ é€‰æ‹©å¯¹æ¯”å¸ç§</span>
            </div>
            <div style="margin-bottom: 8px;">
                <div style="color: var(--text-secondary); margin-bottom: 8px;">å¸ç§1</div>
                <div class="coin-grid" id="coin1Buttons"></div>
            </div>
            <div>
                <div style="color: var(--text-secondary); margin-bottom: 8px;">å¸ç§2</div>
                <div class="coin-grid" id="coin2Buttons"></div>
            </div>
        </div>

        <!-- é¢‘ç‡æ§åˆ¶ + ä»·æ ¼å¡ç‰‡ -->
        <div class="mid-panel">
            <div class="freq-panel">
                <div class="freq-row">
                    <div class="freq-item">
                        <div class="freq-label">
                            <span class="freq-label-text">âš¡ åˆ·æ–°é¢‘ç‡</span>
                            <span class="freq-status" id="refreshStatus">3ç§’</span>
                        </div>
                        <div class="freq-buttons" id="refreshButtons"></div>
                        <div class="custom-freq">
                            <input type="checkbox" id="refreshCustomCheck"> è‡ªå®šä¹‰
                            <input type="number" id="refreshCustomInput" class="custom-input" min="1" max="3600" value="3" disabled> ç§’
                        </div>
                    </div>
                    <div class="freq-item">
                        <div class="freq-label">
                            <span class="freq-label-text">ğŸ“ è®°å½•é¢‘ç‡</span>
                            <span class="freq-status" id="recordStatus">10ç§’</span>
                        </div>
                        <div class="freq-buttons" id="recordButtons"></div>
                        <div class="custom-freq">
                            <input type="checkbox" id="recordCustomCheck"> è‡ªå®šä¹‰
                            <input type="number" id="recordCustomInput" class="custom-input" min="1" max="3600" value="10" disabled> ç§’
                        </div>
                    </div>
                </div>
            </div>
            <div class="price-cards">
                <div class="price-card">
                    <div class="card-bar" id="card1Bar" style="background: var(--btc);"></div>
                    <div class="card-content">
                        <div class="card-title" id="card1Title">BTC/USDT</div>
                        <div>
                            <span class="card-price" id="card1Price">$0.00</span>
                            <span class="card-change" id="card1Change">0.00%</span>
                        </div>
                    </div>
                </div>
                <div class="price-card">
                    <div class="card-bar" id="card2Bar" style="background: var(--eth);"></div>
                    <div class="card-content">
                        <div class="card-title" id="card2Title">ETH/USDT</div>
                        <div>
                            <span class="card-price" id="card2Price">$0.00</span>
                            <span class="card-change" id="card2Change">0.00%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿‘æœŸè®°å½•è¡¨æ ¼ -->
        <div class="records-container">
            <div class="records-header">
                <span class="records-title">ğŸ“‹ è¿‘æœŸè®°å½•</span>
                <span class="records-time" id="currentTime">â±ï¸ --:--:--</span>
            </div>
            <div class="records-table" id="recordsTable">
                <div style="color: var(--text-secondary); text-align: center; padding: 20px;">â³ ç­‰å¾…æ•°æ®...</div>
            </div>
        </div>

        <!-- AIåˆ†æé¢æ¿ -->
        <div class="ai-container">
            <div class="ai-header">
                <div class="ai-title">
                    <span class="ai-title-text">ğŸ¤– DeepSeek AI Â· 4å°æ—¶Kçº¿æ·±åº¦åˆ†æ</span>
                    <span class="ai-subtitle">21é¡¹æŠ€æœ¯æŒ‡æ ‡ | ç»¼åˆè¯„åˆ† | æ”¯æ’‘é˜»åŠ›å¯¹æ¯”</span>
                </div>
                <button class="ai-analyze-btn" id="analyzeBtn">ğŸš€ å¼€å§‹æ·±åº¦åˆ†æ</button>
            </div>
            <div class="ai-content" id="aiContent">
                ğŸ¤– DeepSeek AI Â· 4å°æ—¶Kçº¿å¼ºå¼±å¯¹æ¯” Â· å®æ—¶æ¶¨è·Œå¹…å·®å€¼<br>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
                âœ… å®æ—¶å·®å€¼æ˜¾ç¤ºï¼šè°æ¯”è°å¤šæ¶¨å¤šå°‘ï¼Ÿæ¯ç§’æ›´æ–°<br>
                âœ… åŒå¸åŒæ—¶åˆ†æ | ç»¼åˆè¯„åˆ† | æ”¯æ’‘é˜»åŠ›å¯¹æ¯” | äº¤æ˜“ç­–ç•¥<br>
                â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br>
            </div>
        </div>
    </div>

    <script>
        // ============== å®Œæ•´PythonåŠŸèƒ½ç§»æ¤ ==============
        // é…è‰²æ–¹æ¡ˆ
        const COLORS = {
            bg: '#0B0E14', surface: '#1A1E26', primary: '#3B82F6',
            primary_dark: '#2563EB', secondary: '#8B5CF6', success: '#10B981',
            danger: '#EF4444', warning: '#F59E0B', text_primary: '#FFFFFF',
            text_secondary: '#94A3B8', text_tertiary: '#64748B',
            border: '#2D3748', card: '#1E2430',
            btc: '#F7931A', eth: '#627EEA', sol: '#9945FF',
            bnb: '#F3BA2F', nasdaq: '#00FF9D', ai: '#4F46E5',
        };

        // ============== å¸ç§é…ç½® ==============
        const COINS = [
            { name: 'BTC', symbol: 'BTCUSDT', color: COLORS.btc, display: 'BTC/USDT', class: 'btc' },
            { name: 'ETH', symbol: 'ETHUSDT', color: COLORS.eth, display: 'ETH/USDT', class: 'eth' },
            { name: 'SOL', symbol: 'SOLUSDT', color: COLORS.sol, display: 'SOL/USDT', class: 'sol' },
            { name: 'BNB', symbol: 'BNBUSDT', color: COLORS.bnb, display: 'BNB/USDT', class: 'bnb' },
            { name: 'IXIC', symbol: 'BTCUSDT', color: COLORS.nasdaq, display: 'NASDAQ/IXIC', class: 'nasdaq' } // æš‚æ—¶ç”¨BTCæ•°æ®
        ];

        // ============== é¢‘ç‡é…ç½® ==============
        const REFRESH_OPTIONS = [
            { name: '1ç§’', value: 1, icon: 'âš¡' },
            { name: '3ç§’', value: 3, icon: 'âš¡âš¡' },
            { name: '5ç§’', value: 5, icon: 'âš¡âš¡âš¡' },
            { name: '10ç§’', value: 10, icon: 'â±ï¸' },
            { name: '1åˆ†', value: 60, icon: 'â°' }
        ];

        const RECORD_OPTIONS = [
            { name: '5ç§’', value: 5, icon: 'ğŸ“‹' },
            { name: '10ç§’', value: 10, icon: 'ğŸ“‹ğŸ“‹' },
            { name: '30ç§’', value: 30, icon: 'ğŸ“‹ğŸ“‹ğŸ“‹' },
            { name: '1åˆ†', value: 60, icon: 'ğŸ“Š' },
            { name: '5åˆ†', value: 300, icon: 'ğŸ“ŠğŸ“Š' }
        ];

        // ============== å…¨å±€çŠ¶æ€ ==============
        let selected1 = 0;  // BTC
        let selected2 = 1;  // ETH
        
        // ä»·æ ¼æ•°æ®
        let prices = {};
        let changes24h = {};
        let basePrices = {};
        
        // å†å²è®°å½•
        let historyData = [];
        let startTime = new Date();
        
        // é¢‘ç‡è®¾ç½®
        let refreshInterval = 3;
        let recordInterval = 10;
        let lastRecordTime = new Date();
        
        // AI API Key (ç”¨æˆ·è‡ªå·±çš„)
        const DEEPSEEK_API_KEY = 'sk-061ecbeaefd341efaf1a401d3a317fbb';
        
        // ============== åˆå§‹åŒ–UI ==============
        function initUI() {
            createCoinButtons();
            createFreqButtons();
            startPriceFetcher();
            startTimeUpdater();
        }
        
        // ============== åˆ›å»ºå¸ç§æŒ‰é’® ==============
        function createCoinButtons() {
            const container1 = document.getElementById('coin1Buttons');
            const container2 = document.getElementById('coin2Buttons');
            
            container1.innerHTML = '';
            container2.innerHTML = '';
            
            COINS.forEach((coin, i) => {
                // å¸ç§1æŒ‰é’®
                const btn1 = document.createElement('button');
                btn1.className = `coin-btn ${coin.class} ${i === selected1 ? 'active' : ''}`;
                btn1.textContent = coin.name;
                btn1.onclick = () => { 
                    selected1 = i; 
                    createCoinButtons(); 
                    resetBasePrices();
                    updateAllDisplays();
                };
                container1.appendChild(btn1);
                
                // å¸ç§2æŒ‰é’®
                const btn2 = document.createElement('button');
                btn2.className = `coin-btn ${coin.class} ${i === selected2 ? 'active' : ''}`;
                btn2.textContent = coin.name;
                btn2.onclick = () => { 
                    selected2 = i; 
                    createCoinButtons(); 
                    resetBasePrices();
                    updateAllDisplays();
                };
                container2.appendChild(btn2);
            });
        }
        
        // ============== åˆ›å»ºé¢‘ç‡æŒ‰é’® ==============
        function createFreqButtons() {
            const refreshContainer = document.getElementById('refreshButtons');
            const recordContainer = document.getElementById('recordButtons');
            
            refreshContainer.innerHTML = '';
            recordContainer.innerHTML = '';
            
            REFRESH_OPTIONS.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'freq-btn';
                btn.textContent = `${opt.icon} ${opt.name}`;
                btn.onclick = () => setRefreshInterval(opt.value);
                refreshContainer.appendChild(btn);
            });
            
            RECORD_OPTIONS.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'freq-btn';
                btn.textContent = `${opt.icon} ${opt.name}`;
                btn.onclick = () => setRecordInterval(opt.value);
                recordContainer.appendChild(btn);
            });
            
            // è‡ªå®šä¹‰é¢‘ç‡äº‹ä»¶
            document.getElementById('refreshCustomCheck').onchange = function(e) {
                const input = document.getElementById('refreshCustomInput');
                input.disabled = !e.target.checked;
                if (e.target.checked) {
                    input.focus();
                    setRefreshInterval(parseInt(input.value) || 3);
                } else {
                    setRefreshInterval(3);
                }
            };
            
            document.getElementById('refreshCustomInput').onchange = function(e) {
                if (document.getElementById('refreshCustomCheck').checked) {
                    setRefreshInterval(parseInt(e.target.value) || 3);
                }
            };
            
            document.getElementById('recordCustomCheck').onchange = function(e) {
                const input = document.getElementById('recordCustomInput');
                input.disabled = !e.target.checked;
                if (e.target.checked) {
                    input.focus();
                    setRecordInterval(parseInt(input.value) || 10);
                } else {
                    setRecordInterval(10);
                }
            };
            
            document.getElementById('recordCustomInput').onchange = function(e) {
                if (document.getElementById('recordCustomCheck').checked) {
                    setRecordInterval(parseInt(e.target.value) || 10);
                }
            };
        }
        
        // ============== è®¾ç½®é¢‘ç‡ ==============
        function setRefreshInterval(seconds) {
            refreshInterval = Math.max(1, Math.min(3600, seconds));
            document.getElementById('refreshStatus').innerHTML = `${refreshInterval < 60 ? refreshInterval + 'ç§’' : Math.floor(refreshInterval/60) + 'åˆ†'}`;
        }
        
        function setRecordInterval(seconds) {
            recordInterval = Math.max(1, Math.min(3600, seconds));
            document.getElementById('recordStatus').innerHTML = `${recordInterval < 60 ? recordInterval + 'ç§’' : Math.floor(recordInterval/60) + 'åˆ†'}`;
        }
        
        // ============== é‡ç½®åŸºå‡†ä»·æ ¼ ==============
        function resetBasePrices() {
            basePrices = {};
            historyData = [];
            startTime = new Date();
            updateRecordsTable();
        }
        
        // ============== è·å–å®æ—¶ä»·æ ¼ ==============
        async function fetchPrice(symbol) {
            try {
                const response = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
                const data = await response.json();
                return parseFloat(data.price);
            } catch (e) {
                console.error(e);
                return null;
            }
        }
        
        async function fetch24hChange(symbol) {
            try {
                const response = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`);
                const data = await response.json();
                return parseFloat(data.priceChangePercent);
            } catch (e) {
                console.error(e);
                return 0;
            }
        }
        
        // ============== è·å–4å°æ—¶Kçº¿ ==============
        async function fetch4hKlines(symbol, limit = 50) {
            try {
                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=4h&limit=${limit}`);
                const data = await response.json();
                return data.map(k => ({
                    time: new Date(k[0]),
                    open: parseFloat(k[1]),
                    high: parseFloat(k[2]),
                    low: parseFloat(k[3]),
                    close: parseFloat(k[4]),
                    volume: parseFloat(k[5])
                }));
            } catch (e) {
                console.error(e);
                return [];
            }
        }
        
        // ============== ä»·æ ¼è·å–å¾ªç¯ ==============
        function startPriceFetcher() {
            async function fetchLoop() {
                const coin1 = COINS[selected1];
                const coin2 = COINS[selected2];
                
                // è·å–ä»·æ ¼
                const price1 = await fetchPrice(coin1.symbol);
                const price2 = await fetchPrice(coin2.symbol);
                const change1 = await fetch24hChange(coin1.symbol);
                const change2 = await fetch24hChange(coin2.symbol);
                
                if (price1) prices[coin1.symbol] = price1;
                if (price2) prices[coin2.symbol] = price2;
                changes24h[coin1.symbol] = change1;
                changes24h[coin2.symbol] = change2;
                
                // è®¾ç½®åŸºå‡†ä»·æ ¼ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡ï¼‰
                if (!basePrices[coin1.symbol] && price1) basePrices[coin1.symbol] = price1;
                if (!basePrices[coin2.symbol] && price2) basePrices[coin2.symbol] = price2;
                
                // æ›´æ–°æ‰€æœ‰æ˜¾ç¤º
                updateAllDisplays();
                
                // è®°å½•å†å²æ•°æ®
                const now = new Date();
                if (historyData.length === 0 || (now - lastRecordTime) >= recordInterval * 1000) {
                    recordHistory(coin1, coin2, price1, price2, change1, change2);
                    lastRecordTime = now;
                }
                
                setTimeout(fetchLoop, refreshInterval * 1000);
            }
            fetchLoop();
        }
        
        // ============== è®°å½•å†å²æ•°æ® ==============
        function recordHistory(coin1, coin2, price1, price2, change1, change2) {
            if (!price1 || !price2) return;
            
            const base1 = basePrices[coin1.symbol] || price1;
            const base2 = basePrices[coin2.symbol] || price2;
            
            const changeSinceStart1 = ((price1 - base1) / base1) * 100;
            const changeSinceStart2 = ((price2 - base2) / base2) * 100;
            
            let changeSinceLast1 = 0, changeSinceLast2 = 0;
            if (historyData.length > 0) {
                const last = historyData[historyData.length - 1];
                changeSinceLast1 = ((price1 - last.price1) / last.price1) * 100;
                changeSinceLast2 = ((price2 - last.price2) / last.price2) * 100;
            }
            
            historyData.push({
                time: new Date(),
                name1: coin1.name, name2: coin2.name,
                color1: coin1.color, color2: coin2.color,
                price1, price2,
                change1: changeSinceLast1,
                change2: changeSinceLast2,
                changeSinceStart1, changeSinceStart2
            });
            
            if (historyData.length > 20) {
                historyData = historyData.slice(-20);
            }
            
            updateRecordsTable();
        }
        
        // ============== æ›´æ–°æ‰€æœ‰æ˜¾ç¤º ==============
        function updateAllDisplays() {
            updateDiffDisplay();
            updatePriceCards();
            updateStatusBar();
            updateTimeDisplay();
        }
        
        // ============== æ›´æ–°æ¶¨è·Œå¹…å·®å€¼æ˜¾ç¤º ==============
        function updateDiffDisplay() {
            const coin1 = COINS[selected1];
            const coin2 = COINS[selected2];
            
            const price1 = prices[coin1.symbol] || 0;
            const price2 = prices[coin2.symbol] || 0;
            const base1 = basePrices[coin1.symbol] || price1;
            const base2 = basePrices[coin2.symbol] || price2;
            
            // æ›´æ–°å¸ç§åç§°
            document.getElementById('diffCoin1Symbol').textContent = coin1.name;
            document.getElementById('diffCoin1Symbol').style.color = coin1.color;
            document.getElementById('diffCoin2Symbol').textContent = coin2.name;
            document.getElementById('diffCoin2Symbol').style.color = coin2.color;
            
            if (!price1 || !price2 || price1 === 0 || price2 === 0) {
                document.getElementById('diffCoin1Price').textContent = 'â³ ç­‰å¾…æ•°æ®...';
                document.getElementById('diffCoin2Price').textContent = 'â³ ç­‰å¾…æ•°æ®...';
                return;
            }
            
            // æ ¼å¼åŒ–ä»·æ ¼
            const price1Str = coin1.name === 'IXIC' ? price1.toLocaleString() : `$${price1.toLocaleString()}`;
            const price2Str = coin2.name === 'IXIC' ? price2.toLocaleString() : `$${price2.toLocaleString()}`;
            const base1Str = coin1.name === 'IXIC' ? base1.toLocaleString() : `$${base1.toLocaleString()}`;
            const base2Str = coin2.name === 'IXIC' ? base2.toLocaleString() : `$${base2.toLocaleString()}`;
            
            document.getElementById('diffCoin1Price').textContent = price1Str;
            document.getElementById('diffCoin2Price').textContent = price2Str;
            document.getElementById('diffCoin1Base').innerHTML = `åŸºå‡†: ${base1Str}`;
            document.getElementById('diffCoin2Base').innerHTML = `åŸºå‡†: ${base2Str}`;
            
            // è®¡ç®—æ¶¨è·Œå¹…
            const change1 = ((price1 - base1) / base1) * 100;
            const change2 = ((price2 - base2) / base2) * 100;
            const diff = change1 - change2;
            
            // æ›´æ–°æ¶¨è·Œå¹…æ˜¾ç¤º
            const change1El = document.getElementById('diffCoin1Change');
            const change2El = document.getElementById('diffCoin2Change');
            
            change1El.textContent = `${change1 > 0 ? '+' : ''}${change1.toFixed(2)}%`;
            change1El.className = `coin-change ${change1 >= 0 ? 'up' : 'down'}`;
            change1El.style.background = change1 >= 0 ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)';
            
            change2El.textContent = `${change2 > 0 ? '+' : ''}${change2.toFixed(2)}%`;
            change2El.className = `coin-change ${change2 >= 0 ? 'up' : 'down'}`;
            change2El.style.background = change2 >= 0 ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)';
            
            // æ›´æ–°å¯¹æ¯”ç»“æœ - å®Œå…¨ç§»æ¤Pythoné€»è¾‘
            let resultText = '', resultColor = COLORS.primary;
            
            if (change1 > 0 && change2 > 0) {
                if (diff > 0.01) {
                    resultText = `ğŸ”¥ ${coin1.name} æ¯” ${coin2.name} å¤šæ¶¨ ${diff.toFixed(2)}%`;
                    resultColor = COLORS.success;
                } else if (diff < -0.01) {
                    resultText = `ğŸ”¥ ${coin2.name} æ¯” ${coin1.name} å¤šæ¶¨ ${Math.abs(diff).toFixed(2)}%`;
                    resultColor = COLORS.success;
                } else {
                    resultText = `â– ${coin1.name} ä¸ ${coin2.name} æ¶¨å¹…æŒå¹³`;
                    resultColor = COLORS.text_secondary;
                }
            } else if (change1 < 0 && change2 < 0) {
                if (diff > 0.01) {
                    resultText = `ğŸ’” ${coin1.name} æ¯” ${coin2.name} å°‘è·Œ ${Math.abs(diff).toFixed(2)}%`;
                    resultColor = COLORS.success;
                } else if (diff < -0.01) {
                    resultText = `ğŸ’” ${coin2.name} æ¯” ${coin1.name} å°‘è·Œ ${Math.abs(diff).toFixed(2)}%`;
                    resultColor = COLORS.success;
                } else {
                    resultText = `â– ${coin1.name} ä¸ ${coin2.name} è·Œå¹…æŒå¹³`;
                    resultColor = COLORS.text_secondary;
                }
            } else if (change1 > 0 && change2 < 0) {
                resultText = `ğŸ”¥ ${coin1.name} ä¸Šæ¶¨ vs ${coin2.name} ä¸‹è·Œ`;
                resultColor = COLORS.success;
            } else if (change1 < 0 && change2 > 0) {
                resultText = `ğŸ”¥ ${coin2.name} ä¸Šæ¶¨ vs ${coin1.name} ä¸‹è·Œ`;
                resultColor = COLORS.success;
            } else {
                resultText = `â– ${coin1.name} ä¸ ${coin2.name} æŒå¹³`;
                resultColor = COLORS.text_secondary;
            }
            
            document.getElementById('diffResult').textContent = resultText;
            document.getElementById('diffResultContainer').style.background = resultColor;
        }
        
        // ============== æ›´æ–°ä»·æ ¼å¡ç‰‡ ==============
        function updatePriceCards() {
            const coin1 = COINS[selected1];
            const coin2 = COINS[selected2];
            
            const price1 = prices[coin1.symbol] || 0;
            const price2 = prices[coin2.symbol] || 0;
            const change1 = changes24h[coin1.symbol] || 0;
            const change2 = changes24h[coin2.symbol] || 0;
            
            document.getElementById('card1Title').textContent = coin1.display;
            document.getElementById('card1Bar').style.background = coin1.color;
            document.getElementById('card1Price').textContent = coin1.name === 'IXIC' ? price1.toLocaleString() : `$${price1.toLocaleString()}`;
            document.getElementById('card1Price').style.color = coin1.color;
            document.getElementById('card1Change').textContent = `${change1 > 0 ? '+' : ''}${change1.toFixed(2)}%`;
            document.getElementById('card1Change').className = `card-change ${change1 >= 0 ? 'up' : 'down'}`;
            
            document.getElementById('card2Title').textContent = coin2.display;
            document.getElementById('card2Bar').style.background = coin2.color;
            document.getElementById('card2Price').textContent = coin2.name === 'IXIC' ? price2.toLocaleString() : `$${price2.toLocaleString()}`;
            document.getElementById('card2Price').style.color = coin2.color;
            document.getElementById('card2Change').textContent = `${change2 > 0 ? '+' : ''}${change2.toFixed(2)}%`;
            document.getElementById('card2Change').className = `card-change ${change2 >= 0 ? 'up' : 'down'}`;
        }
        
        // ============== æ›´æ–°å†å²è®°å½•è¡¨æ ¼ ==============
        function updateRecordsTable() {
            const table = document.getElementById('recordsTable');
            
            if (historyData.length === 0) {
                table.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px;">â³ ç­‰å¾…æ•°æ®...</div>';
                return;
            }
            
            let html = '';
            historyData.slice(-8).forEach(data => {
                const price1Str = data.name1 === 'IXIC' ? data.price1.toFixed(2) : `$${data.price1.toFixed(2)}`;
                const price2Str = data.name2 === 'IXIC' ? data.price2.toFixed(2) : `$${data.price2.toFixed(2)}`;
                
                const timeStr = data.time.toLocaleTimeString();
                const change1Str = `${data.change1 > 0 ? '+' : ''}${data.change1.toFixed(2)}%`;
                const change2Str = `${data.change2 > 0 ? '+' : ''}${data.change2.toFixed(2)}%`;
                
                // å¼ºå¼±åˆ¤æ–­
                let strength = '', strengthClass = '';
                const diff = data.change1 - data.change2;
                
                if (Math.abs(diff) < 0.1) {
                    strength = '= æŒå¹³';
                    strengthClass = 'equal';
                } else if (diff > 0) {
                    strength = `^ ${data.name1}å¼º +${diff.toFixed(2)}%`;
                    strengthClass = 'up';
                } else {
                    strength = `^ ${data.name2}å¼º +${Math.abs(diff).toFixed(2)}%`;
                    strengthClass = 'up';
                }
                
                html += `<div class="record-row">
                    <span class="record-time">${timeStr}</span>
                    <span class="record-coin1" style="color: ${data.color1};">${data.name1}</span>
                    <span class="record-price1">${price1Str}</span>
                    <span class="record-change1 ${data.change1 >= 0 ? 'up' : 'down'}">${change1Str}</span>
                    <span class="record-coin2" style="color: ${data.color2};">${data.name2}</span>
                    <span class="record-price2">${price2Str}</span>
                    <span class="record-change2 ${data.change2 >= 0 ? 'up' : 'down'}">${change2Str}</span>
                    <span class="record-strength ${strengthClass}">${strength}</span>
                </div>`;
            });
            
            table.innerHTML = html;
        }
        
        // ============== æ›´æ–°æ—¶é—´æ˜¾ç¤º ==============
        function updateTimeDisplay() {
            document.getElementById('currentTime').innerHTML = `â±ï¸ ${new Date().toLocaleTimeString()}`;
        }
        
        function startTimeUpdater() {
            setInterval(updateTimeDisplay, 1000);
        }
        
        // ============== æ›´æ–°çŠ¶æ€æ  ==============
        function updateStatusBar() {
            const coin1 = COINS[selected1];
            const coin2 = COINS[selected2];
            document.getElementById('statusText').innerHTML = `ğŸŸ¢ ${coin1.name}/${coin2.name} Â· âš¡${refreshInterval < 60 ? refreshInterval + 'ç§’' : Math.floor(refreshInterval/60) + 'åˆ†'} Â· ğŸ“${recordInterval < 60 ? recordInterval + 'ç§’' : Math.floor(recordInterval/60) + 'åˆ†'}`;
        }
        
        // ============== æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨ ==============
        const TechnicalIndicators = {
            calculateMA: (prices, period) => {
                if (prices.length < period) return null;
                return parseFloat((prices.slice(-period).reduce((a,b) => a+b, 0) / period).toFixed(2));
            },
            
            calculateMACD: (prices) => {
                if (prices.length < 26) return [0,0,0];
                const ema12 = prices.slice(-12).reduce((a,b) => a+b, 0) / 12;
                const ema26 = prices.slice(-26).reduce((a,b) => a+b, 0) / 26;
                const dif = parseFloat((ema12 - ema26).toFixed(3));
                const dea = dif;
                const macd = parseFloat(((dif - dea) * 2).toFixed(3));
                return [dif, dea, macd];
            },
            
            calculateBollinger: (prices, period = 20) => {
                if (prices.length < period) return [null, null, null, null];
                const ma = prices.slice(-period).reduce((a,b) => a+b, 0) / period;
                const std = Math.sqrt(prices.slice(-period).map(p => Math.pow(p - ma, 2)).reduce((a,b) => a+b, 0) / period);
                const upper = parseFloat((ma + 2 * std).toFixed(2));
                const lower = parseFloat((ma - 2 * std).toFixed(2));
                const bPercent = parseFloat(((prices[prices.length-1] - lower) / (upper - lower)).toFixed(3));
                return [upper, ma, lower, bPercent];
            },
            
            calculateRSI: (prices, period = 14) => {
                if (prices.length < period + 1) return 50;
                const deltas = [];
                for (let i = 1; i < prices.length; i++) {
                    deltas.push(prices[i] - prices[i-1]);
                }
                const gains = deltas.slice(-period).filter(d => d > 0);
                const losses = deltas.slice(-period).filter(d => d < 0).map(d => -d);
                const avgGain = gains.length ? gains.reduce((a,b) => a+b, 0) / period : 0;
                const avgLoss = losses.length ? losses.reduce((a,b) => a+b, 0) / period : 0;
                if (avgLoss === 0) return 100;
                const rs = avgGain / avgLoss;
                return parseFloat((100 - (100 / (1 + rs))).toFixed(1));
            }
        };
        
        // ============== Kçº¿è·å–å™¨ ==============
        const KlineFetcher = {
            get4hKlines: fetch4hKlines
        };
        
        // ============== DeepSeek AIåˆ†æ ==============
        const DeepSeekAnalyzer = {
            API_URL: 'https://api.deepseek.com/v1/chat/completions',
            API_KEY: DEEPSEEK_API_KEY,
            
            analyzePair: async (coin1, coin2, klines1, klines2, basePrice1, basePrice2, currentPrice1, currentPrice2) => {
                const name1 = coin1.name;
                const name2 = coin2.name;
                
                // æå–Kçº¿æ•°æ®
                const closes1 = klines1.slice(-30).map(k => k.close);
                const highs1 = klines1.slice(-30).map(k => k.high);
                const lows1 = klines1.slice(-30).map(k => k.low);
                const closes2 = klines2.slice(-30).map(k => k.close);
                const highs2 = klines2.slice(-30).map(k => k.high);
                const lows2 = klines2.slice(-30).map(k => k.low);
                
                // è®¡ç®—æ¶¨è·Œå¹…å·®å€¼
                const change1 = ((currentPrice1 - basePrice1) / basePrice1) * 100;
                const change2 = ((currentPrice2 - basePrice2) / basePrice2) * 100;
                const diff = change1 - change2;
                
                let strengthText = '';
                if (diff > 0.3) {
                    strengthText = `ğŸ”¥ ${name1} æ¯” ${name2} å¤šæ¶¨ ${diff.toFixed(2)}%`;
                } else if (diff < -0.3) {
                    strengthText = `ğŸ”¥ ${name2} æ¯” ${name1} å¤šæ¶¨ ${Math.abs(diff).toFixed(2)}%`;
                } else {
                    strengthText = `â– ${name1} ä¸ ${name2} æ¶¨è·Œå¹…æŒå¹³ï¼Œå·®å€¼ ${diff.toFixed(2)}%`;
                }
                
                // è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
                const ma20_1 = TechnicalIndicators.calculateMA(closes1, 20) || currentPrice1;
                const ma20_2 = TechnicalIndicators.calculateMA(closes2, 20) || currentPrice2;
                
                const [dif1, dea1, macd1] = TechnicalIndicators.calculateMACD(closes1);
                const [dif2, dea2, macd2] = TechnicalIndicators.calculateMACD(closes2);
                
                const [bb_upper1, bb_mid1, bb_lower1, bb_percent1] = TechnicalIndicators.calculateBollinger(closes1);
                const [bb_upper2, bb_mid2, bb_lower2, bb_percent2] = TechnicalIndicators.calculateBollinger(closes2);
                
                const rsi1 = TechnicalIndicators.calculateRSI(closes1);
                const rsi2 = TechnicalIndicators.calculateRSI(closes2);
                
                // ç®€åŒ–ç‰ˆè¯„åˆ†
                let score1 = 0, score2 = 0;
                if (currentPrice1 > ma20_1) score1 += 1; else score1 -= 1;
                if (currentPrice2 > ma20_2) score2 += 1; else score2 -= 1;
                if (macd1 > 0) score1 += 1; else score1 -= 1;
                if (macd2 > 0) score2 += 1; else score2 -= 1;
                if (rsi1 > 50) score1 += 1; else score1 -= 1;
                if (rsi2 > 50) score2 += 1; else score2 -= 1;
                if (bb_percent1 > 0.5) score1 += 1; else score1 -= 1;
                if (bb_percent2 > 0.5) score2 += 1; else score2 -= 1;
                
                const stronger = score1 > score2 ? name1 : score2 > score1 ? name2 : 'æŒå¹³';
                const scoreDiff = Math.abs(score1 - score2);
                
                // ç”Ÿæˆåˆ†ææŠ¥å‘Š
                const report = `${name1} vs ${name2} 4h å¼ºå¼±å¯¹æ¯”åˆ†ææŠ¥å‘Š
åˆ†ææ—¶é—´ï¼š${new Date().toLocaleString()}

ã€ğŸ“ˆ æ¶¨è·Œå¹…å·®å€¼å¯¹æ¯”ã€‘ï¼ˆæ ¸å¿ƒæŒ‡æ ‡ï¼‰
â€¢ ${name1} 20å°æ—¶æ¶¨è·Œ: ${change1.toFixed(2)}%
â€¢ ${name2} 20å°æ—¶æ¶¨è·Œ: ${change2.toFixed(2)}%
â€¢ **${strengthText}**
â€¢ åŸºå‡†ä»·: ${name1} ${basePrice1.toFixed(2)} â†’ ${currentPrice1.toFixed(2)} | ${name2} ${basePrice2.toFixed(2)} â†’ ${currentPrice2.toFixed(2)}

ã€å½“å‰æŠ€æœ¯æ€åŠ¿ã€‘
â€¢ ${name1}: ${currentPrice1.toFixed(2)} (MA20${currentPrice1 > ma20_1 ? 'ä¸Š' : 'ä¸‹'}, MACD${macd1 > 0 ? 'å¤š' : 'ç©º'}, RSI${rsi1})
â€¢ ${name2}: ${currentPrice2.toFixed(2)} (MA20${currentPrice2 > ma20_2 ? 'ä¸Š' : 'ä¸‹'}, MACD${macd2 > 0 ? 'å¤š' : 'ç©º'}, RSI${rsi2})

ã€å¼ºå¼±ç»¼åˆåˆ¤åˆ«ã€‘
â€¢ ç»¼åˆè¯„åˆ†: ${name1} ${score1}åˆ† vs ${name2} ${score2}åˆ†
â€¢ æŠ€æœ¯å ä¼˜: ${stronger} é¢†å…ˆ ${scoreDiff}åˆ†

ã€æ”¯æ’‘é˜»åŠ›å¯¹æ¯”ã€‘
â€¢ ${name1}: æ”¯æ’‘ ${bb_lower1 ? bb_lower1.toFixed(2) : '--'} | å‹åŠ› ${bb_mid1 ? bb_mid1.toFixed(2) : '--'}
â€¢ ${name2}: æ”¯æ’‘ ${bb_lower2 ? bb_lower2.toFixed(2) : '--'} | å‹åŠ› ${bb_mid2 ? bb_mid2.toFixed(2) : '--'}

ã€äº¤æ˜“å»ºè®®ã€‘
â€¢ æ¶¨è·Œå¹…å·®å€¼ç­–ç•¥: **${diff > 0.3 ? `å½“å‰${name1}ç›¸å¯¹å¼ºåŠ¿ï¼Œå¯å…³æ³¨${name1}å›è¸©æœºä¼š` : diff < -0.3 ? `å½“å‰${name2}ç›¸å¯¹å¼ºåŠ¿ï¼Œå¯å…³æ³¨${name2}å›è¸©æœºä¼š` : 'æ¶¨è·Œå¹…å·®å€¼è¿‡å°ï¼Œè§‚æœ›ä¸ºä¸»'}**

ã€é£é™©æç¤ºã€‘
â€¢ ${name1}é£é™©: ${rsi1 > 65 ? 'RSIåé«˜' : 'æ­£å¸¸'}
â€¢ ${name2}é£é™©: ${rsi2 > 65 ? 'RSIåé«˜' : 'æ­£å¸¸'}
`;

                return report;
            }
        };
        
        // ============== AIåˆ†ææŒ‰é’®äº‹ä»¶ ==============
        document.getElementById('analyzeBtn').onclick = async function() {
            const coin1 = COINS[selected1];
            const coin2 = COINS[selected2];
            
            const basePrice1 = basePrices[coin1.symbol] || prices[coin1.symbol] || 0;
            const basePrice2 = basePrices[coin2.symbol] || prices[coin2.symbol] || 0;
            const currentPrice1 = prices[coin1.symbol] || 0;
            const currentPrice2 = prices[coin2.symbol] || 0;
            
            if (basePrice1 === 0 || basePrice2 === 0 || currentPrice1 === 0 || currentPrice2 === 0) {
                document.getElementById('aiContent').innerHTML = 'âš ï¸ æ­£åœ¨è·å–ä»·æ ¼æ•°æ®ï¼Œè¯·ç¨å...';
                return;
            }
            
            document.getElementById('aiContent').innerHTML = `ğŸ¤– æ­£åœ¨è·å–${coin1.name}å’Œ${coin2.name}çš„4å°æ—¶Kçº¿æ•°æ®...<br>ğŸ“Š åŸºå‡†ä»·æ ¼: ${coin1.name} ${basePrice1.toFixed(2)} | ${coin2.name} ${basePrice2.toFixed(2)}`;
            
            try {
                const symbol1 = coin1.symbol;
                const symbol2 = coin2.symbol;
                
                const klines1 = await KlineFetcher.get4hKlines(symbol1, 50);
                const klines2 = await KlineFetcher.get4hKlines(symbol2, 50);
                
                if (klines1.length < 20 || klines2.length < 20) {
                    const change1 = ((currentPrice1 - basePrice1) / basePrice1) * 100;
                    const change2 = ((currentPrice2 - basePrice2) / basePrice2) * 100;
                    const diff = change1 - change2;
                    let strengthText = '';
                    if (diff > 0.3) strengthText = `ğŸ”¥ ${coin1.name} æ¯” ${coin2.name} å¤šæ¶¨ ${diff.toFixed(2)}%`;
                    else if (diff < -0.3) strengthText = `ğŸ”¥ ${coin2.name} æ¯” ${coin1.name} å¤šæ¶¨ ${Math.abs(diff).toFixed(2)}%`;
                    else strengthText = `â– ${coin1.name} ä¸ ${coin2.name} æ¶¨è·Œå¹…æŒå¹³ï¼Œå·®å€¼ ${diff.toFixed(2)}%`;
                    
                    const fallback = `${coin1.name} vs ${coin2.name} 4h å¼ºå¼±å¯¹æ¯”åˆ†ææŠ¥å‘Š
åˆ†ææ—¶é—´ï¼š${new Date().toLocaleString()}

ã€ğŸ“ˆ æ¶¨è·Œå¹…å·®å€¼å¯¹æ¯”ã€‘ï¼ˆæ ¸å¿ƒæŒ‡æ ‡ï¼‰
â€¢ ${coin1.name} æ¶¨è·Œ: ${change1.toFixed(2)}%
â€¢ ${coin2.name} æ¶¨è·Œ: ${change2.toFixed(2)}%
â€¢ **${strengthText}**
â€¢ åŸºå‡†ä»·: ${coin1.name} ${basePrice1.toFixed(2)} â†’ ${currentPrice1.toFixed(2)} | ${coin2.name} ${basePrice2.toFixed(2)} â†’ ${currentPrice2.toFixed(2)}

âš ï¸ 4å°æ—¶Kçº¿æ•°æ®ä¸è¶³ï¼Œä»¥ä¸Šä¸ºå®æ—¶ä»·æ ¼å¯¹æ¯”åˆ†æ
`;
                    document.getElementById('aiContent').innerHTML = fallback.replace(/\n/g, '<br>');
                    return;
                }
                
                const report = await DeepSeekAnalyzer.analyzePair(
                    coin1, coin2, klines1, klines2,
                    basePrice1, basePrice2, currentPrice1, currentPrice2
                );
                
                document.getElementById('aiContent').innerHTML = report.replace(/\n/g, '<br>');
                
            } catch (e) {
                console.error(e);
                document.getElementById('aiContent').innerHTML = `âŒ åˆ†æå¤±è´¥: ${e.message}<br>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥`;
            }
        };
        
        // ============== é¡µé¢åŠ è½½å¯åŠ¨ ==============
        window.onload = initUI;
    </script>
</body>
</html>
